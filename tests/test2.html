<!-- test2.html -->


<!DOCTYPE html>
<meta charset="utf-8">
<style>

text {
  font: bold 48px monospace;
  fill: #666;
  opacity: 1;
}

.enter {
  fill: green;
}

.update {
  fill: #333;
}

.exit {
  fill: brown;
}

rect {
	width:22px; height:22px;
}

</style>
<svg width="960" height="500"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var alphabet = [1,2,3,4,5,6,7,8,9,10].sort();
var data = [{"key": "Title", "values": alphabet}];

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height"),
    g = svg.append("g").attr("transform", "translate(32," + (height / 2) + ")");

function update(data) {
  var t = d3.transition()
      .duration(750);


  // JOIN new data with old elements.
  var incoming = data[0].values;
  // var text = data[0].key;

  var text = g.selectAll("text")
    .data(data, function(d) {return d.key});

  text.exit()
    .style("fill","red")
    .transition(t)
      .style("opacity", 1e-6)
      .remove();

  text.enter()
    .append("text")
    .text(function(d) {return d.key })

  var rect = g.selectAll("rect")
    .data(incoming, function(d) {return d; });

  // EXIT old elements not present in new data.
  rect.exit()
      .attr("class", "exit")
    .transition(t)
      // .attr("y", 60)
      // .attr("x", 4460)
      .style("fill-opacity", 1e-6)
      .remove();

  // UPDATE old elements present in new data.
  rect.attr("class", "update")
      .attr("y", 0)
      .style("fill-opacity", 1)
    .transition(t)
      .attr("x", function(d, i) { return i * 32; });

  // ENTER new elements present in new data.
  rect.enter().append("rect")
      .attr("class", "enter")
      .attr("dy", ".35em")
      .attr("y", 0)
      .attr("x", function(d, i) { return i * 32; })
      .style("fill-opacity", 1e-6)
      // .rect(function(d) { return d; })
    .transition(t)
      .attr("y", 0)
      .style("fill-opacity", 1);
}

// The initial display.
update(data);

// Grab a random sample of letters from the alphabet, in alphabetical order.
d3.interval(function() {
//  var data = randomArray( getRand(1,10), 10).sort();
  // console.log(data);

  var data = [2,4,6,8].sort();

  update([{"key": "New Title", "values": data}]);
}, 1500);

// generate a random array
function randomArray(length, max) {
    return Array.apply(null, Array(length)).map(function() {
        return Math.round(Math.random() * max);
    });
}

// Returns a random integer between min and max
function getRand(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}
</script>